{"ast":null,"code":"import axios from 'axios';\nimport { getAuth, signInWithEmailAndPassword, signInWithCustomToken, signOut } from 'firebase/auth';\nimport { getCurrentUserIdToken } from '../firebase';\nconst API_BASE_URL = 'http://localhost:8000';\n\n// Create axios instance with default config\nconst axiosInstance = axios.create({\n  baseURL: API_BASE_URL\n});\n\n// Add request interceptor to add token to requests\naxiosInstance.interceptors.request.use(async config => {\n  try {\n    const idToken = await getCurrentUserIdToken();\n    if (idToken) {\n      config.headers['Authorization'] = `Bearer ${idToken}`;\n    }\n  } catch (error) {\n    console.log('No authenticated user or error getting token');\n  }\n  return config;\n}, error => Promise.reject(error));\nexport const api = {\n  // Auth endpoints\n  logout: async () => {\n    try {\n      const token = localStorage.getItem('access_token');\n      if (token) {\n        // Call backend to logout\n        await axiosInstance.post('/auth/logout', {}, {\n          headers: {\n            'Authorization': `Bearer ${token}`\n          }\n        });\n      }\n\n      // Sign out from Firebase\n      const auth = getAuth();\n      await signOut(auth);\n\n      // Remove token from localStorage\n      localStorage.removeItem('access_token');\n    } catch (error) {\n      console.error('Logout error:', error);\n      throw error;\n    }\n  },\n  register: async (email, password) => {\n    try {\n      // Call backend to register user\n      const response = await axiosInstance.post('/auth/register', {\n        email,\n        password,\n        username: email // Using email as username\n      });\n\n      // Get custom token from backend\n      const customToken = response.data.access_token;\n\n      // Sign in with custom token\n      const auth = getAuth();\n      await signInWithCustomToken(auth, customToken);\n\n      // Get ID token\n      const idToken = await getCurrentUserIdToken();\n\n      // Store ID token\n      localStorage.setItem('access_token', idToken);\n      return {\n        access_token: idToken\n      };\n    } catch (error) {\n      console.error('Registration error:', error);\n      throw error;\n    }\n  },\n  login: async (email, password) => {\n    try {\n      // First, authenticate with Firebase client SDK\n      const auth = getAuth();\n      await signInWithEmailAndPassword(auth, email, password);\n\n      // Get ID token from Firebase\n      const idToken = await getCurrentUserIdToken();\n\n      // Call backend to verify the token\n      const response = await axiosInstance.post('/auth/verify-token', {}, {\n        headers: {\n          'Authorization': `Bearer ${idToken}`\n        }\n      });\n\n      // If verification is successful, store the token\n      if (response.status === 200) {\n        localStorage.setItem('access_token', idToken);\n        return {\n          access_token: idToken\n        };\n      } else {\n        throw new Error('Token verification failed');\n      }\n    } catch (error) {\n      console.error('Login error:', error);\n      throw error;\n    }\n  },\n  // Vocabulary endpoints\n  getVocabulary: async () => {\n    const response = await axiosInstance.get('/vocabulary/');\n    return response.data;\n  },\n  addVocabulary: async vocab => {\n    const response = await axiosInstance.post('/vocabulary/', vocab);\n    return response.data;\n  },\n  deleteVocabulary: async vocabId => {\n    await axiosInstance.delete(`/vocabulary/${vocabId}`);\n  },\n  updateVocabulary: async (vocabId, data) => {\n    const response = await axiosInstance.put(`/vocabulary/${vocabId}`, data);\n    return response.data;\n  },\n  // Quiz endpoints\n  generateQuiz: async (numQuestions = 10) => {\n    const response = await axiosInstance.get('/vocabulary/quiz/user/', {\n      params: {\n        num_questions: numQuestions\n      }\n    });\n    return response.data;\n  }\n};","map":{"version":3,"names":["axios","getAuth","signInWithEmailAndPassword","signInWithCustomToken","signOut","getCurrentUserIdToken","API_BASE_URL","axiosInstance","create","baseURL","interceptors","request","use","config","idToken","headers","error","console","log","Promise","reject","api","logout","token","localStorage","getItem","post","auth","removeItem","register","email","password","response","username","customToken","data","access_token","setItem","login","status","Error","getVocabulary","get","addVocabulary","vocab","deleteVocabulary","vocabId","delete","updateVocabulary","put","generateQuiz","numQuestions","params","num_questions"],"sources":["/Users/duongthanhduy/TOEIC_FE/src/services/api.ts"],"sourcesContent":["import axios from 'axios';\nimport { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, signInWithCustomToken, signOut } from 'firebase/auth';\nimport { getCurrentUserIdToken } from '../firebase';\n\nconst API_BASE_URL = 'http://localhost:8000';\n\n// Create axios instance with default config\nconst axiosInstance = axios.create({\n  baseURL: API_BASE_URL,\n});\n\n// Add request interceptor to add token to requests\naxiosInstance.interceptors.request.use(\n  async (config) => {\n    try {\n      const idToken = await getCurrentUserIdToken();\n      if (idToken) {\n        config.headers['Authorization'] = `Bearer ${idToken}`;\n      }\n    } catch (error) {\n      console.log('No authenticated user or error getting token');\n    }\n    return config;\n  },\n  (error) => Promise.reject(error)\n);\n\nexport interface Vocabulary {\n  id: number;\n  word: string;\n  meaning: string;\n  example?: string;\n  user_id: number;\n  created_at: string;\n  mastery_level?: number;\n  notes?: string;\n}\n\nexport interface VocabIn {\n  word: string;\n  meaning: string;\n  example?: string;\n  mastery_level?: number;\n  notes?: string;\n}\n\nexport interface QuizQuestion {\n  question: string;\n  choices: string[];\n  answer: string;\n}\n\nexport interface UserAuth {\n  email: string;\n  password: string;\n}\n\nexport interface UserCreate {\n  email: string;\n  password: string;\n}\n\nexport interface TokenResponse {\n  access_token: string;\n}\n\nexport const api = {\n  // Auth endpoints\n  logout: async (): Promise<void> => {\n    try {\n      const token = localStorage.getItem('access_token');\n      if (token) {\n        // Call backend to logout\n        await axiosInstance.post('/auth/logout', {}, {\n          headers: {\n            'Authorization': `Bearer ${token}`\n          }\n        });\n      }\n      \n      // Sign out from Firebase\n      const auth = getAuth();\n      await signOut(auth);\n      \n      // Remove token from localStorage\n      localStorage.removeItem('access_token');\n    } catch (error) {\n      console.error('Logout error:', error);\n      throw error;\n    }\n  },\n  register: async (email: string, password: string): Promise<TokenResponse> => {\n    try {\n      // Call backend to register user\n      const response = await axiosInstance.post('/auth/register', {\n        email,\n        password,\n        username: email // Using email as username\n      });\n      \n      // Get custom token from backend\n      const customToken = response.data.access_token;\n      \n      // Sign in with custom token\n      const auth = getAuth();\n      await signInWithCustomToken(auth, customToken);\n      \n      // Get ID token\n      const idToken = await getCurrentUserIdToken();\n      \n      // Store ID token\n      localStorage.setItem('access_token', idToken);\n      \n      return { access_token: idToken };\n    } catch (error) {\n      console.error('Registration error:', error);\n      throw error;\n    }\n  },\n\n  login: async (email: string, password: string): Promise<TokenResponse> => {\n    try {\n      // First, authenticate with Firebase client SDK\n      const auth = getAuth();\n      await signInWithEmailAndPassword(auth, email, password);\n      \n      // Get ID token from Firebase\n      const idToken = await getCurrentUserIdToken();\n      \n      // Call backend to verify the token\n      const response = await axiosInstance.post('/auth/verify-token', {}, {\n        headers: {\n          'Authorization': `Bearer ${idToken}`\n        }\n      });\n      \n      // If verification is successful, store the token\n      if (response.status === 200) {\n        localStorage.setItem('access_token', idToken);\n        return { access_token: idToken };\n      } else {\n        throw new Error('Token verification failed');\n      }\n    } catch (error) {\n      console.error('Login error:', error);\n      throw error;\n    }\n  },\n\n  // Vocabulary endpoints\n  getVocabulary: async (): Promise<Vocabulary[]> => {\n    const response = await axiosInstance.get('/vocabulary/');\n    return response.data;\n  },\n\n  addVocabulary: async (vocab: VocabIn): Promise<Vocabulary> => {\n    const response = await axiosInstance.post('/vocabulary/', vocab);\n    return response.data;\n  },\n\n  deleteVocabulary: async (vocabId: number): Promise<void> => {\n    await axiosInstance.delete(`/vocabulary/${vocabId}`);\n  },\n\n  updateVocabulary: async (vocabId: number, data: Partial<VocabIn>): Promise<Vocabulary> => {\n    const response = await axiosInstance.put(`/vocabulary/${vocabId}`, data);\n    return response.data;\n  },\n\n  // Quiz endpoints\n  generateQuiz: async (numQuestions: number = 10): Promise<QuizQuestion[]> => {\n    const response = await axiosInstance.get('/vocabulary/quiz/user/', {\n      params: { num_questions: numQuestions },\n    });\n    return response.data;\n  },\n};"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}