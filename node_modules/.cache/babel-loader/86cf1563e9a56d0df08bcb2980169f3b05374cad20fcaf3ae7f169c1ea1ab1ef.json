{"ast":null,"code":"import axios from 'axios';\nimport { getAuth, signInWithEmailAndPassword, signInWithCustomToken, signOut } from 'firebase/auth';\nimport { getCurrentUserIdToken } from '../firebase';\nconst API_BASE_URL = 'http://localhost:8000';\n\n// Create axios instance with default config\nconst axiosInstance = axios.create({\n  baseURL: API_BASE_URL\n});\n\n// Add request interceptor to add token to requests\naxiosInstance.interceptors.request.use(async config => {\n  try {\n    // Get token from localStorage first (faster than requesting a new one)\n    const storedToken = localStorage.getItem('access_token');\n\n    // If we have a stored token, use it\n    if (storedToken) {\n      config.headers['Authorization'] = `Bearer ${storedToken}`;\n    } else {\n      // Otherwise try to get a fresh token\n      try {\n        const idToken = await getCurrentUserIdToken();\n        if (idToken) {\n          localStorage.setItem('access_token', idToken);\n          config.headers['Authorization'] = `Bearer ${idToken}`;\n        }\n      } catch (tokenError) {\n        console.log('Error getting fresh token:', tokenError);\n      }\n    }\n  } catch (error) {\n    console.log('No authenticated user or error getting token');\n  }\n  return config;\n}, error => Promise.reject(error));\nexport const api = {\n  // Auth endpoints\n  logout: async () => {\n    try {\n      const token = localStorage.getItem('access_token');\n      if (token) {\n        // Call backend to logout\n        await axiosInstance.post('/auth/logout', {}, {\n          headers: {\n            'Authorization': `Bearer ${token}`\n          }\n        });\n      }\n\n      // Sign out from Firebase\n      const auth = getAuth();\n      await signOut(auth);\n\n      // Remove token from localStorage\n      localStorage.removeItem('access_token');\n    } catch (error) {\n      console.error('Logout error:', error);\n      throw error;\n    }\n  },\n  register: async (email, password) => {\n    try {\n      // Call backend to register user\n      const response = await axiosInstance.post('/auth/register', {\n        email,\n        password,\n        username: email,\n        // Using email as username\n        full_name: email.split('@')[0] // Default full name from email\n      });\n\n      // Get custom token from backend\n      const customToken = response.data.access_token;\n\n      // Sign in with custom token\n      const auth = getAuth();\n      await signInWithCustomToken(auth, customToken);\n\n      // Get ID token\n      const idToken = await getCurrentUserIdToken();\n\n      // Store ID token\n      localStorage.setItem('access_token', idToken);\n      return {\n        access_token: idToken\n      };\n    } catch (error) {\n      console.error('Registration error:', error);\n      throw error;\n    }\n  },\n  login: async (email, password) => {\n    try {\n      // First, sign in with Firebase directly\n      const auth = getAuth();\n      await signInWithEmailAndPassword(auth, email, password);\n\n      // Get ID token from Firebase\n      const idToken = await getCurrentUserIdToken();\n\n      // Store the ID token\n      localStorage.setItem('access_token', idToken);\n\n      // Verify the token with the backend\n      try {\n        await axiosInstance.post('/auth/verify-token', {}, {\n          headers: {\n            'Authorization': `Bearer ${idToken}`\n          }\n        });\n      } catch (verifyError) {\n        console.warn('Token verification warning:', verifyError);\n        // Continue even if verification fails - the deps.py will handle creating the user if needed\n      }\n      return {\n        access_token: idToken\n      };\n    } catch (error) {\n      console.error('Login error:', error);\n      throw error;\n    }\n  },\n  // Vocabulary endpoints\n  getVocabulary: async () => {\n    const response = await axiosInstance.get('/vocabulary/');\n    return response.data;\n  },\n  addVocabulary: async vocab => {\n    const response = await axiosInstance.post('/vocabulary/', vocab);\n    return response.data;\n  },\n  deleteVocabulary: async vocabId => {\n    await axiosInstance.delete(`/vocabulary/${vocabId}`);\n  },\n  updateVocabulary: async (vocabId, data) => {\n    const response = await axiosInstance.put(`/vocabulary/user/update/${vocabId}`, data);\n    return response.data;\n  },\n  // User-specific vocabulary endpoints\n  getUserVocabulary: async (skip = 0, limit = 100) => {\n    const response = await axiosInstance.get('/vocabulary/user/', {\n      params: {\n        skip,\n        limit\n      }\n    });\n    return response.data;\n  },\n  addVocabularyToUser: async (vocabId, masteryLevel = 0, notes) => {\n    const response = await axiosInstance.post(`/vocabulary/user/add/${vocabId}`, {\n      mastery_level: masteryLevel,\n      notes: notes\n    });\n    return response.data;\n  },\n  removeVocabularyFromUser: async vocabId => {\n    await axiosInstance.delete(`/vocabulary/user/remove/${vocabId}`);\n  },\n  // Quiz endpoints\n  generateQuiz: async (numQuestions = 10) => {\n    const response = await axiosInstance.get('/vocabulary/quiz/user/', {\n      params: {\n        num_questions: numQuestions\n      }\n    });\n    return response.data;\n  }\n};","map":{"version":3,"names":["axios","getAuth","signInWithEmailAndPassword","signInWithCustomToken","signOut","getCurrentUserIdToken","API_BASE_URL","axiosInstance","create","baseURL","interceptors","request","use","config","storedToken","localStorage","getItem","headers","idToken","setItem","tokenError","console","log","error","Promise","reject","api","logout","token","post","auth","removeItem","register","email","password","response","username","full_name","split","customToken","data","access_token","login","verifyError","warn","getVocabulary","get","addVocabulary","vocab","deleteVocabulary","vocabId","delete","updateVocabulary","put","getUserVocabulary","skip","limit","params","addVocabularyToUser","masteryLevel","notes","mastery_level","removeVocabularyFromUser","generateQuiz","numQuestions","num_questions"],"sources":["/Users/duongthanhduy/Toeic_vocabulary/TOEIC_FE/src/services/api.ts"],"sourcesContent":["import axios from 'axios';\nimport { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, signInWithCustomToken, signOut } from 'firebase/auth';\nimport { getCurrentUserIdToken } from '../firebase';\n\nconst API_BASE_URL = 'http://localhost:8000';\n\n// Create axios instance with default config\nconst axiosInstance = axios.create({\n  baseURL: API_BASE_URL,\n});\n\n// Add request interceptor to add token to requests\naxiosInstance.interceptors.request.use(\n  async (config) => {\n    try {\n      // Get token from localStorage first (faster than requesting a new one)\n      const storedToken = localStorage.getItem('access_token');\n      \n      // If we have a stored token, use it\n      if (storedToken) {\n        config.headers['Authorization'] = `Bearer ${storedToken}`;\n      } else {\n        // Otherwise try to get a fresh token\n        try {\n          const idToken = await getCurrentUserIdToken();\n          if (idToken) {\n            localStorage.setItem('access_token', idToken);\n            config.headers['Authorization'] = `Bearer ${idToken}`;\n          }\n        } catch (tokenError) {\n          console.log('Error getting fresh token:', tokenError);\n        }\n      }\n    } catch (error) {\n      console.log('No authenticated user or error getting token');\n    }\n    return config;\n  },\n  (error) => Promise.reject(error)\n);\n\nexport interface Vocabulary {\n  id: number;\n  word: string;\n  meaning: string;\n  example?: string;\n  user_id: number;\n  created_at: string;\n  mastery_level?: number;\n  notes?: string;\n}\n\nexport interface VocabIn {\n  word: string;\n  meaning: string;\n  example?: string;\n  mastery_level?: number;\n  notes?: string;\n}\n\nexport interface QuizQuestion {\n  question: string;\n  choices: string[];\n  answer: string;\n}\n\nexport interface UserAuth {\n  email: string;\n  password: string;\n}\n\nexport interface UserCreate {\n  email: string;\n  password: string;\n}\n\nexport interface TokenResponse {\n  access_token: string;\n}\n\nexport const api = {\n  // Auth endpoints\n  logout: async (): Promise<void> => {\n    try {\n      const token = localStorage.getItem('access_token');\n      if (token) {\n        // Call backend to logout\n        await axiosInstance.post('/auth/logout', {}, {\n          headers: {\n            'Authorization': `Bearer ${token}`\n          }\n        });\n      }\n      \n      // Sign out from Firebase\n      const auth = getAuth();\n      await signOut(auth);\n      \n      // Remove token from localStorage\n      localStorage.removeItem('access_token');\n    } catch (error) {\n      console.error('Logout error:', error);\n      throw error;\n    }\n  },\n  register: async (email: string, password: string): Promise<TokenResponse> => {\n    try {\n      // Call backend to register user\n      const response = await axiosInstance.post('/auth/register', {\n        email,\n        password,\n        username: email, // Using email as username\n        full_name: email.split('@')[0] // Default full name from email\n      });\n      \n      // Get custom token from backend\n      const customToken = response.data.access_token;\n      \n      // Sign in with custom token\n      const auth = getAuth();\n      await signInWithCustomToken(auth, customToken);\n      \n      // Get ID token\n      const idToken = await getCurrentUserIdToken();\n      \n      // Store ID token\n      localStorage.setItem('access_token', idToken);\n      \n      return { access_token: idToken };\n    } catch (error) {\n      console.error('Registration error:', error);\n      throw error;\n    }\n  },\n\n  login: async (email: string, password: string): Promise<TokenResponse> => {\n    try {\n      // First, sign in with Firebase directly\n      const auth = getAuth();\n      await signInWithEmailAndPassword(auth, email, password);\n      \n      // Get ID token from Firebase\n      const idToken = await getCurrentUserIdToken();\n      \n      // Store the ID token\n      localStorage.setItem('access_token', idToken);\n      \n      // Verify the token with the backend\n      try {\n        await axiosInstance.post('/auth/verify-token', {}, {\n          headers: {\n            'Authorization': `Bearer ${idToken}`\n          }\n        });\n      } catch (verifyError) {\n        console.warn('Token verification warning:', verifyError);\n        // Continue even if verification fails - the deps.py will handle creating the user if needed\n      }\n      \n      return { access_token: idToken };\n    } catch (error) {\n      console.error('Login error:', error);\n      throw error;\n    }\n  },\n\n  // Vocabulary endpoints\n  getVocabulary: async (): Promise<Vocabulary[]> => {\n    const response = await axiosInstance.get('/vocabulary/');\n    return response.data;\n  },\n\n  addVocabulary: async (vocab: VocabIn): Promise<Vocabulary> => {\n    const response = await axiosInstance.post('/vocabulary/', vocab);\n    return response.data;\n  },\n\n  deleteVocabulary: async (vocabId: number): Promise<void> => {\n    await axiosInstance.delete(`/vocabulary/${vocabId}`);\n  },\n\n  updateVocabulary: async (vocabId: number, data: Partial<VocabIn>): Promise<Vocabulary> => {\n    const response = await axiosInstance.put(`/vocabulary/user/update/${vocabId}`, data);\n    return response.data;\n  },\n  \n  // User-specific vocabulary endpoints\n  getUserVocabulary: async (skip: number = 0, limit: number = 100): Promise<Vocabulary[]> => {\n    const response = await axiosInstance.get('/vocabulary/user/', {\n      params: { skip, limit }\n    });\n    return response.data;\n  },\n\n  addVocabularyToUser: async (vocabId: number, masteryLevel: number = 0, notes?: string): Promise<Vocabulary> => {\n    const response = await axiosInstance.post(`/vocabulary/user/add/${vocabId}`, {\n      mastery_level: masteryLevel,\n      notes: notes\n    });\n    return response.data;\n  },\n\n  removeVocabularyFromUser: async (vocabId: number): Promise<void> => {\n    await axiosInstance.delete(`/vocabulary/user/remove/${vocabId}`);\n  },\n\n  // Quiz endpoints\n  generateQuiz: async (numQuestions: number = 10): Promise<QuizQuestion[]> => {\n    const response = await axiosInstance.get('/vocabulary/quiz/user/', {\n      params: { num_questions: numQuestions },\n    });\n    return response.data;\n  },\n};"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}